<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Продукты - QolayKZ Admin</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link rel="stylesheet" href="../css/styles.css">
  <link rel="stylesheet" href="css/admin.css">
</head>
<body>
  <div class="admin-layout">
    <aside class="admin-sidebar">
      <div class="sidebar-header">
        <h1>QolayKZ Admin</h1>
      </div>
      <nav class="sidebar-nav">
        <a href="index.html" class="nav-item" data-page="dashboard">
          <i class="fas fa-chart-line"></i> Главная
        </a>
        <a href="owners.html" class="nav-item" data-page="owners">
          <i class="fas fa-user-tie"></i> Владельцы
        </a>
        <a href="restaurants.html" class="nav-item" data-page="restaurants">
          <i class="fas fa-building"></i> Рестораны
        </a>
        <a href="staff.html" class="nav-item" data-page="staff">
          <i class="fas fa-users"></i> Персонал
        </a>
        <a href="tables.html" class="nav-item" data-page="tables">
          <i class="fas fa-chair"></i> Столы
        </a>
        <a href="categories.html" class="nav-item" data-page="categories">
          <i class="fas fa-folder"></i> Категории
        </a>
        <a href="products.html" class="nav-item active" data-page="products">
          <i class="fas fa-utensils"></i> Продукты
        </a>
        <a href="ingredients.html" class="nav-item" data-page="ingredients">
          <i class="fas fa-leaf"></i> Ингредиенты
        </a>
        <a href="banners.html" class="nav-item" data-page="banners">
          <i class="fas fa-bullseye"></i> Баннеры
        </a>
        <a href="social-links.html" class="nav-item" data-page="social-links">
          <i class="fas fa-share-alt"></i> Социальные ссылки
        </a>
        <a href="images.html" class="nav-item" data-page="images">
          <i class="fas fa-images"></i> Изображения
        </a>
        <a href="orders.html" class="nav-item" data-page="orders">
          <i class="fas fa-box"></i> Заказы
        </a>
        <a href="reviews.html" class="nav-item" data-page="reviews">
          <i class="fas fa-star"></i> Отзывы
        </a>
      </nav>
    </aside>

    <main class="admin-main">
      <header class="admin-header">
        <h2>Продукты</h2>
        <div class="header-actions">
          <span id="user-info" style="margin-right: 16px; color: #666;"></span>
          <select id="restaurant-filter" class="input" style="max-width: 200px; margin-right: 12px;">
            <option value="">Все рестораны</option>
          </select>
          <select id="category-filter" class="input" style="max-width: 200px; margin-right: 12px;">
            <option value="">Все категории</option>
          </select>
          <button class="btn btn-primary" onclick="openProductModal()">
            + Добавить продукт
          </button>
        </div>
      </header>

      <div class="admin-content">
        <div class="list-container" id="products-list">
          <div class="loading">Загрузка...</div>
        </div>
      </div>
    </main>
  </div>

  <!-- Modal для создания/редактирования продукта -->
  <div id="product-modal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h3 id="product-modal-title">Добавить продукт</h3>
        <button class="modal-close" onclick="closeProductModal()">&times;</button>
      </div>
      <form id="product-form" class="admin-form">
        <input type="hidden" id="product-id">
        
        <div class="form-group">
          <label for="product-restaurant">Ресторан</label>
          <select id="product-restaurant" required>
            <option value="">Выберите ресторан</option>
          </select>
        </div>

        <div class="form-group">
          <label for="product-category">Категория</label>
          <select id="product-category" required>
            <option value="">Выберите категорию</option>
          </select>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label for="product-name-ru">Название (RU)</label>
            <input type="text" id="product-name-ru" required>
          </div>
          <div class="form-group">
            <label for="product-name-kk">Название (KK)</label>
            <input type="text" id="product-name-kk" required>
          </div>
          <div class="form-group">
            <label for="product-name-en">Название (EN)</label>
            <input type="text" id="product-name-en" required>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label for="product-description-ru">Описание (RU)</label>
            <textarea id="product-description-ru"></textarea>
          </div>
          <div class="form-group">
            <label for="product-description-kk">Описание (KK)</label>
            <textarea id="product-description-kk"></textarea>
          </div>
          <div class="form-group">
            <label for="product-description-en">Описание (EN)</label>
            <textarea id="product-description-en"></textarea>
          </div>
        </div>

        <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 16px;">
          <div class="form-group">
            <label for="product-price">Цена (KZT)</label>
            <input type="number" id="product-price" step="0.01" min="0" required>
          </div>
          <div class="form-group">
            <label for="product-station">Станция</label>
            <select id="product-station" required>
              <option value="HOT">Горячая</option>
              <option value="COLD">Холодная</option>
              <option value="BAR">Бар</option>
              <option value="NONE">Нет</option>
            </select>
          </div>
          <div class="form-group">
            <label for="product-image">Изображения продукта</label>
            <input type="file" id="product-image" accept="image/*" multiple>
            <p style="font-size: 12px; color: #666; margin-top: 4px;">Можно выбрать несколько изображений</p>
            <div id="product-images-preview" style="margin-top: 12px; display: none;">
              <p style="font-size: 12px; color: #666; margin-bottom: 8px;">Новые изображения для загрузки:</p>
              <div id="product-images-preview-list" style="display: flex; flex-wrap: wrap; gap: 12px;"></div>
            </div>
            <div id="product-images-current" style="margin-top: 12px; display: none;">
              <p style="font-size: 12px; color: #666; margin-bottom: 8px;">Текущие изображения:</p>
              <div id="product-images-current-list" style="display: flex; flex-wrap: wrap; gap: 12px;"></div>
            </div>
          </div>
        </div>

        <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid #ddd;">
          <h4 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: var(--primary-color);">Пищевая ценность</h4>
          <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
            <div class="form-group">
              <label for="product-calories">Калории (ккал)</label>
              <input type="number" id="product-calories" step="1" min="0" placeholder="Например: 325">
              <p style="font-size: 12px; color: #666; margin-top: 4px;">Энергетическая ценность продукта</p>
            </div>
            <div class="form-group">
              <label for="product-size-value">Вес/объем</label>
              <div style="display: flex; gap: 8px; align-items: center;">
                <input type="number" id="product-size-value" step="1" min="0" placeholder="Например: 300" style="flex: 1;">
                <select id="product-size-unit" style="width: 110px;">
                  <option value="GRAM">гр</option>
                  <option value="ML">мл</option>
                </select>
              </div>
              <p style="font-size: 12px; color: #666; margin-top: 4px;">Укажите размер порции и единицу измерения</p>
            </div>
          </div>

          <div class="form-group" style="margin-top: 16px;">
            <label for="product-ingredient-input">Состав</label>
            <div class="ingredient-input-wrap">
              <input type="text" id="product-ingredient-input" placeholder="Начните вводить ингредиент" autocomplete="off">
              <div id="product-ingredient-suggestions" class="ingredient-suggestions" style="display: none;"></div>
            </div>
            <div id="product-ingredient-selected" class="ingredient-selected"></div>
            <p style="font-size: 12px; color: #666; margin-top: 4px;">Введите на русском, выберите из списка или создайте новый ингредиент.</p>
          </div>
        </div>

        <!-- Модификаторы продукта -->
        <div id="product-modifiers-section" style="margin-top: 24px; padding-top: 24px; border-top: 1px solid #ddd; display: none;">
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
            <h4 style="margin: 0;">Модификаторы</h4>
            <button type="button" class="btn btn-secondary" onclick="if(currentProductId) openModifiersModal(currentProductId)" style="padding: 8px 16px;">
              Управление модификаторами
            </button>
          </div>
          <div id="product-modifiers-list">
            <div class="loading">Загрузка модификаторов...</div>
          </div>
        </div>

        <div class="form-actions">
          <button type="submit" class="btn btn-primary">Сохранить</button>
          <button type="button" class="btn btn-secondary" onclick="closeProductModal()">Отмена</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Modal для вариантов продукта -->
  <div id="product-variants-modal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
      <div class="modal-header">
        <h3 id="product-variants-title">Варианты продукта</h3>
        <button class="modal-close" onclick="closeProductVariantsModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div id="product-variants-list-container" style="margin-bottom: 16px;">
          <div class="loading">Загрузка...</div>
        </div>
        <form id="product-variant-form" class="admin-form">
          <input type="hidden" id="product-variant-id" />
          <div class="form-group">
            <label>Название (RU)</label>
            <input id="product-variant-name-ru" class="input" required />
          </div>
          <div class="form-group">
            <label>Название (KK)</label>
            <input id="product-variant-name-kk" class="input" required />
          </div>
          <div class="form-group">
            <label>Название (EN)</label>
            <input id="product-variant-name-en" class="input" required />
          </div>
          <div class="form-group">
            <label>Цена (₸)</label>
            <input id="product-variant-price" class="input" required />
          </div>
          <div class="form-group">
            <label>Сортировка</label>
            <input id="product-variant-sort" class="input" type="number" value="0" />
          </div>
          <div class="form-group">
            <label style="display: inline-flex; align-items: center; gap: 8px;">
              <input id="product-variant-active" type="checkbox" checked />
              Активен
            </label>
          </div>
          <div class="form-actions">
            <button type="submit" class="btn btn-primary">Сохранить вариант</button>
            <button type="button" class="btn btn-secondary" onclick="resetProductVariantForm()">Очистить</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Modal для управления модификаторами -->
  <div id="modifiers-modal" class="modal">
    <div class="modal-content" style="max-width: 900px; max-height: 90vh; overflow-y: auto;">
      <div class="modal-header">
        <h3>Модификаторы продукта</h3>
        <button class="modal-close" onclick="closeModifiersModal()">&times;</button>
      </div>
      <div id="modifiers-content" style="padding: 20px;">
        <div class="loading">Загрузка...</div>
      </div>
    </div>
  </div>

  <script src="../config.js"></script>
  <script src="../js/utils.js"></script>
  <script src="../js/api.js"></script>
  <script src="../js/auth.js"></script>
  <script src="js/admin-auth.js"></script>
  <script src="js/admin-api.js"></script>
  <script src="js/products.js"></script>
  <script src="js/modifiers.js"></script>
</body>
</html>
